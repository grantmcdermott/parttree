<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to parttree • parttree</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to parttree">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parttree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/parttree-intro.html">Introduction to parttree</a></li>
    <li><a class="dropdown-item" href="../articles/parttree-art.html">Abstract art with parttree and friends</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/grantmcdermott/parttree"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to parttree</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/parttree/blob/main/vignettes/parttree-intro.Rmd" class="external-link"><code>vignettes/parttree-intro.Rmd</code></a></small>
      <div class="d-none name"><code>parttree-intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivating-example-classifying-penguin-species">Motivating example: Classifying penguin species<a class="anchor" aria-label="anchor" href="#motivating-example-classifying-penguin-species"></a>
</h2>
<p>Start by loading the <strong>parttree</strong> package alongside
<strong>rpart</strong>, which comes bundled with the base R
installation. For the basic examples that follow, I’ll use the
well-known <a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">Palmer
Penguins</a> dataset to demonstrate functionality. You can load this
dataset via the parent package (as I have here), or import it directly
as a CSV <a href="https://vincentarelbundock.github.io/Rdatasets/csv/palmerpenguins/penguins.csv" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grantmcdermott.com/parttree/">parttree</a></span><span class="op">)</span>  <span class="co"># This package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span>     <span class="co"># For fitting decisions trees</span></span>
<span></span>
<span><span class="co"># install.packages("palmerpenguins")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"penguins"</span>, package <span class="op">=</span> <span class="st">"palmerpenguins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Adelie  Torgersen           39.1          18.7               181        <span style="text-decoration: underline;">3</span>750</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Adelie  Torgersen           39.5          17.4               186        <span style="text-decoration: underline;">3</span>800</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Adelie  Torgersen           40.3          18                 195        <span style="text-decoration: underline;">3</span>250</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Adelie  Torgersen           <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Adelie  Torgersen           36.7          19.3               193        <span style="text-decoration: underline;">3</span>450</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Adelie  Torgersen           39.3          20.6               190        <span style="text-decoration: underline;">3</span>650</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</span></span></span></code></pre></div>
<p>Dataset in hand, let’s say that we are interested in predicting
penguin <em>species</em> as a function of 1) flipper length and 2) bill
length. We could model this as a simple decision tree:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">bill_length_mm</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span><span class="va">tree</span></span>
<span><span class="co">#&gt; n=342 (2 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; node), split, n, loss, yval, (yprob)</span></span>
<span><span class="co">#&gt;       * denotes terminal node</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1) root 342 191 Adelie (0.441520468 0.198830409 0.359649123)  </span></span>
<span><span class="co">#&gt;   2) flipper_length_mm&lt; 206.5 213  64 Adelie (0.699530516 0.295774648 0.004694836)  </span></span>
<span><span class="co">#&gt;     4) bill_length_mm&lt; 43.35 150   5 Adelie (0.966666667 0.033333333 0.000000000) *</span></span>
<span><span class="co">#&gt;     5) bill_length_mm&gt;=43.35 63   5 Chinstrap (0.063492063 0.920634921 0.015873016) *</span></span>
<span><span class="co">#&gt;   3) flipper_length_mm&gt;=206.5 129   7 Gentoo (0.015503876 0.038759690 0.945736434) *</span></span></code></pre></div>
<p>Like most tree-based frameworks, <strong>rpart</strong> comes with a
default <code>plot</code> method for visualizing the resulting node
splits.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">tree</span>, use.n <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/rpart_plot-1.png" width="90%"></p>
<p>While this is okay, I don’t feel that it provides much intuition
about the model’s prediction on the <em>scale of the actual data</em>.
In other words, what I’d prefer to see is: How has our tree partitioned
the original penguin data?</p>
<p>This is where <strong>parttree</strong> enters the fray. The package
is named for its primary workhorse function <code><a href="../reference/parttree.html">parttree()</a></code>,
which extracts all of the information needed to produce a nice plot of
our tree partitions alongside the original data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptree</span> <span class="op">=</span> <span class="fu"><a href="../reference/parttree.html">parttree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ptree</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_cl_plot-1.png" width="90%"></p>
<p><em>Et voila!</em> Now we can clearly see how our model has divided
up the Cartesian space of the data. Gentoo penguins typically have
longer flippers than Chinstrap or Adelie penguins, while the latter have
the shortest bills.</p>
<p>From the perspective of the end-user, the <code>ptree</code> parttree
object is not all that interesting in of itself. It is simply a data
frame that contains the basic information needed for our plot (partition
coordinates, etc.). You can think of it as a helpful intermediate object
on our way to the visualization of interest.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See also `attr(ptree, "parttree")`</span></span>
<span><span class="va">ptree</span></span>
<span><span class="co">#&gt;   node   species                                                  path  xmin</span></span>
<span><span class="co">#&gt; 1    3    Gentoo                            flipper_length_mm &gt;= 206.5 206.5</span></span>
<span><span class="co">#&gt; 2    4    Adelie  flipper_length_mm &lt; 206.5 --&gt; bill_length_mm &lt; 43.35  -Inf</span></span>
<span><span class="co">#&gt; 3    5 Chinstrap flipper_length_mm &lt; 206.5 --&gt; bill_length_mm &gt;= 43.35  -Inf</span></span>
<span><span class="co">#&gt;    xmax  ymin  ymax</span></span>
<span><span class="co">#&gt; 1   Inf  -Inf   Inf</span></span>
<span><span class="co">#&gt; 2 206.5  -Inf 43.35</span></span>
<span><span class="co">#&gt; 3 206.5 43.35   Inf</span></span></code></pre></div>
<p>Speaking of visualization, underneath the hood
<code>plot.parttree</code> calls the powerful <a href="https://grantmcdermott.com/tinyplot/" class="external-link"><strong>tinyplot</strong></a>
package. All of the latter’s various customization arguments can be
passed on to our <code>parttree</code> plot to make it look a bit nicer.
For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ptree</span>, pch <span class="op">=</span> <span class="fl">16</span>, palette <span class="op">=</span> <span class="st">"classic"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, grid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_cl_plot_custom-1.png" width="90%"></p>
<div class="section level3">
<h3 id="continuous-predictions">Continuous predictions<a class="anchor" aria-label="anchor" href="#continuous-predictions"></a>
</h3>
<p>In addition to discrete classification problems,
<strong>parttree</strong> also supports regression trees with continuous
independent variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_cont</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">bill_length_mm</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree_cont</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parttree.html">parttree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, palette <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_reg_plot-1.png" width="90%"></p>
</div>
</div>
<div class="section level2">
<h2 id="supported-model-classes">Supported model classes<a class="anchor" aria-label="anchor" href="#supported-model-classes"></a>
</h2>
<p>Alongside the <a href="https://CRAN.R-project.org/package=rpart" class="external-link"><strong>rpart</strong></a>
model objects that we have been working with thus far,
<strong>parttree</strong> also supports decision trees created by the <a href="https://CRAN.R-project.org/package=partykit" class="external-link"><strong>partykit</strong></a>
package. Here we see how the latter’s <code>ctree</code> (conditional
inference tree) algorithm yields a slightly more sophisticated
partitioning that the former’s default.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://partykit.r-forge.r-project.org/partykit/" class="external-link">partykit</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: grid</span></span>
<span><span class="co">#&gt; Loading required package: libcoin</span></span>
<span><span class="co">#&gt; Loading required package: mvtnorm</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/partykit/man/ctree.html" class="external-link">ctree</a></span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">bill_length_mm</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parttree.html">parttree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, palette <span class="op">=</span> <span class="st">"classic"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_ctree_plot-1.png" width="90%"></p>
<p><strong>parttree</strong> also supports a variety of “frontend” modes
that call <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart::rpart()</a></code> as the underlying engine. This
includes packages from both the <a href="https://mlr3.mlr-org.com/" class="external-link"><strong>mlr3</strong></a> and <a href="https://www.tidymodels.org/" class="external-link"><strong>tidymodels</strong></a> (<a href="https://parsnip.tidymodels.org/" class="external-link">parsnip</a> or <a href="https://workflows.tidymodels.org/" class="external-link">workflows</a>) ecosystems. Here
is a quick demonstration using <strong>parsnip</strong>, where we’ll
also pull in a different dataset just to change things up a little.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co">## For consistent jitter</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paulhendricks/titanic" class="external-link">titanic</a></span><span class="op">)</span> <span class="co">## Just for a different data set</span></span>
<span></span>
<span><span class="va">titanic_train</span><span class="op">$</span><span class="va">Survived</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">titanic_train</span><span class="op">$</span><span class="va">Survived</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Build our tree using parsnip (but with rpart as the model engine)</span></span>
<span><span class="va">ti_tree</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/decision_tree.html" class="external-link">decision_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">Survived</span> <span class="op">~</span> <span class="va">Pclass</span> <span class="op">+</span> <span class="va">Age</span>, data <span class="op">=</span> <span class="va">titanic_train</span><span class="op">)</span></span>
<span><span class="co">## Now pass to parttree and plot</span></span>
<span><span class="va">ti_tree</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parttree.html">parttree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, jitter <span class="op">=</span> <span class="cn">TRUE</span>, palette <span class="op">=</span> <span class="st">"dark"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/titanic_plot-1.png" width="90%"></p>
</div>
<div class="section level2">
<h2 id="ggplot2">ggplot2<a class="anchor" aria-label="anchor" href="#ggplot2"></a>
</h2>
<p>The default <code>plot.parttree</code> method produces a base
graphics plot. But we also support <strong>ggplot2</strong> via with a
dedicated <code><a href="../reference/geom_parttree.html">geom_parttree()</a></code> function. Here we demonstrate
with our initial classification tree from earlier.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## re-using the tree model object from above...</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_cl_ggplot2-1.png" width="90%"></p>
<p>Compared to the “native” <code>plot.parttree</code> method, note that
the <strong>ggplot2</strong> workflow requires a few tweaks:</p>
<ul>
<li>We need to need to plot the original dataset as a separate layer
(i.e., <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point()</a></code>).</li>
<li>
<code><a href="../reference/geom_parttree.html">geom_parttree()</a></code> accepts the tree object
<em>itself</em>, not the result of <code><a href="../reference/parttree.html">parttree()</a></code>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This is because
&lt;code&gt;geom_parttree(data = &amp;lt;tree&amp;gt;)&lt;/code&gt; calls
&lt;code&gt;parttree(&amp;lt;tree&amp;gt;)&lt;/code&gt; internally.&lt;/p&gt;"><sup>1</sup></a>
</li>
</ul>
<p>Continuous regression trees can also be drawn with
<code>geom_parttree</code>. However, I recommend adjusting the plot fill
aesthetic since your model will likely partition the data into intervals
that don’t match up exactly with the raw data. The easiest way to do
this is by setting your colour and fill aesthetic together as part of
the same <code>scale_colour_*</code> call.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## re-using the tree_cont model object from above...</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tree_cont</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">body_mass_g</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'colour'</span>, <span class="st">'fill'</span><span class="op">)</span><span class="op">)</span> <span class="co"># NB: Set colour + fill together</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_reg_ggplot2-1.png" width="90%"></p>
<div class="section level3">
<h3 id="gotcha-ggplot-orientation">Gotcha: (gg)plot orientation<a class="anchor" aria-label="anchor" href="#gotcha-ggplot-orientation"></a>
</h3>
<p>As we have already said, <code><a href="../reference/geom_parttree.html">geom_parttree()</a></code> calls the
companion <code><a href="../reference/parttree.html">parttree()</a></code> function internally, which coerces the
<strong>rpart</strong> tree object into a data frame that is easily
understood by <strong>ggplot2</strong>. For example, consider our
initial “ptree” object from earlier.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ptree = parttree(tree)</span></span>
<span><span class="va">ptree</span></span>
<span><span class="co">#&gt;   node   species                                                  path  xmin</span></span>
<span><span class="co">#&gt; 1    3    Gentoo                            flipper_length_mm &gt;= 206.5 206.5</span></span>
<span><span class="co">#&gt; 2    4    Adelie  flipper_length_mm &lt; 206.5 --&gt; bill_length_mm &lt; 43.35  -Inf</span></span>
<span><span class="co">#&gt; 3    5 Chinstrap flipper_length_mm &lt; 206.5 --&gt; bill_length_mm &gt;= 43.35  -Inf</span></span>
<span><span class="co">#&gt;    xmax  ymin  ymax</span></span>
<span><span class="co">#&gt; 1   Inf  -Inf   Inf</span></span>
<span><span class="co">#&gt; 2 206.5  -Inf 43.35</span></span>
<span><span class="co">#&gt; 3 206.5 43.35   Inf</span></span></code></pre></div>
<p>Again, the resulting data frame is designed to be amenable to a
<strong>ggplot2</strong> geom layer, with columns like
<code>xmin</code>, <code>xmax</code>, etc. specifying aesthetics that
<strong>ggplot2</strong> recognizes. (Fun fact:
<code><a href="../reference/geom_parttree.html">geom_parttree()</a></code> is really just a thin wrapper around
<code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect()</a></code>.) The goal of <strong>parttree</strong> is to
abstract away these kinds of details from the user, so that they can
just specify <code><a href="../reference/geom_parttree.html">geom_parttree()</a></code>—with a valid tree object as
the data input—and be done with it. However, while this generally works
well, it can sometimes lead to unexpected behaviour in terms of plot
orientation. That’s because it’s hard to guess ahead of time what the
user will specify as the x and y variables (i.e. axes) in their other
<strong>ggplot2</strong> layers.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The default &lt;code&gt;plot.partree&lt;/code&gt; method doesn’t
have this problem because it assigns the x and y variables for both the
partitions and raw data points as part of the same function call.&lt;/p&gt;"><sup>2</sup></a> To see what I mean, let’s redo our penguin
plot from earlier, but this time switch the axes in the main
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> call.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## First, redo our first plot but this time switch the x and y variables</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">penguins</span>, </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">)</span> <span class="co">## Switched!</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add on our tree (and some preemptive titling..)</span></span>
<span><span class="va">p3</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Oops!"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Looks like a mismatch between our x and y axes..."</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_cl_ggplot_mismatch-1.png" width="90%"></p>
<p>As was the case here, this kind of orientation mismatch is normally
(hopefully) pretty easy to recognize. To fix, we can use the
<code>flip = TRUE</code> argument to flip the orientation of the
<code>geom_parttree</code> layer.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p3</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    flip <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co">## Flip the orientation</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"That's better"</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_cl_ggplot_mismatch_flip-1.png" width="90%"></p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
